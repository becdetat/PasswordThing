<!DOCTYPE html> 
<html> 
	<head> 
	<title>Password Thing</title> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.css" />
	<script src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.js"></script>
</head> 
<body> 

<script>
var pwdthing = {};
pwdthing.webdb = {};
pwdthing.webdb.db = null;
pwdthing.webdb.open = function(){
	pwdthing.webdb.db = openDatabase(
		'pwdthing',
		'0.1',
		'Password Thing',
		1024*1024*5);
};
pwdthing.webdb.createTable = function() {
	pwdthing.webdb.db.transaction(function(t) {
		t.executeSql('CREATE TABLE IF NOT EXISTS things(title, username, password, website)');
	});
};
pwdthing.webdb.dropTable = function(){
	pwdthing.webdb.db.transaction(function(t){
		t.executeSql('DROP TABLE things');
	});
};
pwdthing.webdb.onError = function(tx, error) {
	alert(error.message);
};

pwdthing.refreshThings = function(){
	pwdthing.webdb.db.transaction(function(t){
		t.executeSql('SELECT * FROM things', [], function(tx, rx){
			var html = '';
			for (var i = 0; i < rx.rows.length; i ++) {
				html += '<li>'+rx.rows.item(i).title+'</li>';
			}
			$('ul#things').html(html);
		});
	});
};

pwdthing.addAuth = function(){
	var title = $('#title').val();
	var username = $('#username').val();
	var password = $('#password').val();
	var website = $('#website').val();
	pwdthing.webdb.db.transaction(function(t){
		t.executeSql(
			'INSERT INTO things(title, username, password, website) VALUES(?, ?, ?, ?)', 
			[title, username, password, website], 
			function(t, r){ },
			function(t, error) {
				alert(error.message);
			}
		);
	});
	pwdthing.refreshThings();
	$.mobile.changePage('#home');
};

$(function(){
	pwdthing.webdb.open();
	pwdthing.webdb.createTable();
	$('#add form').submit(pwdthing.addAuth);
	pwdthing.refreshThings();
});

</script>

<div data-role="page" id="home">
	<div data-role="header">
		<h1>Password Thing</h1>
	</div>
	<div data-role="content">
		<p>Saved things:</p>
		<ul id="things"></ul>
	</div>
	<div data-role="footer" class="ui-bar">
		<a href="#add" data-icon="plus">Add</a>
		<a href="#" id="reset-db">Reset DB</a>
	</div>
</div>
<script>
$(function(){
	$('#reset-db').click(function(){
		if (confirm('Really reset the database?')) {
			pwdthing.webdb.dropTable();
			pwdthing.webdb.createTable();
			pwdthing.refreshThings();
		}
		return false;
	});
});
</script>

<div data-role="page" id="add">
	<div data-role="header">
		<h1>Add user/pass</h1>
	</div>
	<div data-role="content">
		<form>
			<div data-role="fieldcontain">
				<label for="title">Title:</label> <input type="text" name="title" id="title" />
			</div>
			<div data-role="fieldcontain">
				<label for="username">Username:</label> <input type="text" name="username" id="username" />
			</div>
			<div data-role="fieldcontain">
				<label for="password">Password:</label> <input type="text" name="password" id="password" />
			</div>
			<div data-role="fieldcontain">
				<label for="site">Website:</label> <input type="text" name="website" id="site" />
			</div>
			<button type="submit">Save</button>
		</form>
	</div>
	<div data-role="footer" class="ui-bar">
		<a href="#home" data-icon="delete">Cancel</a>
	</div>
</div>

</body>
</html>